<!DOCTYPE html>
<html>
    <head>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

        <script>

            var initialSurplus = -3790;
            var annualBudget   = 5000;
            var daysIntoYear   = getDayOfYear();
            var amountAccrued  = Math.round(annualBudget * daysIntoYear / 365);
            var salaryBonus    = 0;
            var pointsEarned   = 0;
            var amountSpent    = 0;

            function getDayOfYear() {
                var now = new Date();
                var start = new Date(now.getFullYear(), 0, 0);
                var diff = (now - start) + ((start.getTimezoneOffset() - now.getTimezoneOffset()) * 60 * 1000);
                var oneDay = 1000 * 60 * 60 * 24;
                return Math.floor(diff / oneDay);
            }

            function getNet() {
                return amountAccrued + initialSurplus + salaryBonus + pointsEarned - amountSpent;
            }

            function formatNumber(number) {
                if (number >= 0) return number;
                return '<span class="red">(' + (-number) + ')</span>';
            }

            function renderNumbers() {
                $("#initialSurplus").html(formatNumber(initialSurplus));
                $("#annualBudget").html(formatNumber(annualBudget));
                $("#daysIntoYear").html(formatNumber(daysIntoYear));
                $("#amountAccrued").html(formatNumber(amountAccrued));
                $("#pointsEarned").html(formatNumber(pointsEarned));
                $("#salaryBonus").html(formatNumber(salaryBonus));
                $("#amountSpent").html(formatNumber(amountSpent));
                $("#net").html(formatNumber(getNet()));
            }

            $(function () {
                $.get("points.txt", function(data) {
                    pointsEarned = 0;
                    lines = data.split("\n");
                    $.each(lines, function(line){
                        if (lines[line] != "")
                            pointsEarned += parseInt(lines[line]) / 100;
                    });
                    renderNumbers();
                });

                renderNumbers();
            });
        </script>

        <style>
            h1 {font-family: monospace; font-weight: normal;}
            th {text-align: left;}
            table, tr {font-family: monospace; vertical-align: top;}
            td:first-child, th:first-child {padding-right: 5em;}
            .money .red {color: red;}
        </style>
    </head>
    <body>

        <h1>2018 Windsor Travel Budget</h1>

        <table>
            <tr>
                <th>Item</th><th>$$</th>
            </tr>
            <tr>
                <td>Travel surplus (debt) from 2017</td>
                <td class="money"><span id="initialSurplus"></span></td>
            </tr>
            <tr>
                <td>Travel budget for 2018</td>
                <td class="money"><span id="annualBudget"></span></td></tr>
            <tr>
                <td>
                    2018 travel budget accrued<br>
                    <small>(<span id="daysIntoYear"></span> days into the year)</small>
                </td>
                <td class="money"><span id="amountAccrued"></span></td>
            </tr>
            <tr>
                <td>Extra points earned<br><small>(cash value)</small></td>
                <td class="money"><span id="pointsEarned"></span></td>
            </tr>
            <tr>
                <td>Bonus from Rachel's salary<br><small>(10% gross)</small></td>
                <td class="money"><span id="salaryBonus"></span></td>
            </tr>

            <tr><td>&nbsp;</td><td></td></tr>

            <tr>
                <td>Spent this year</td>
                <td class="money"><span id="amountSpent"></span></td>
            </tr>

            <tr><td>&nbsp;</td><td></td></tr>

            <tr>
                <td>Current available travel budget</td>
                <td class="money"><span id="net"></span></td>
            </tr>
        </table>
    </body>
</html>
